---
title: "Replot Drug Curves"
author: "Sara Gosline"
date: "10/19/2021"
output: html_document
---

For each of the drugs and models of interest we would like to plot all of the dose response curves in the same cformat so that they can be combined.

```{r setup, include=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)

require(remotes)
if(!require(mpnstXenoModeling)){
  remotes::install_github('sgosline/mpnstXenoModeling')
  library(mpnstXenoModeling)
}

if(!require('leapr')){
  remotes::install_github('biodataganache/leapR')
  library(leapr)
}

if(!require('DT')){
  install.packages("DT")
  library(leapr)
}

library(dplyr)
library(ggrepel)
```

## Load drug data and expression data

```{r mutation data,message=FALSE,warning=FALSE,echo=FALSE}
mpnstXenoModeling::loadPDXData()


```

## Plot drugs

We now want to plot drug performance across samples of interest, so we can do a side by side of drugs and their combinations.

```{r drug list}

##these are the drugs we want to evaluate!!!
drug.list<-list(MirdaTrab=c('Mirdametinib','Mirdametinib;Trabectedin','Trabectedin'),
                OlaTrab=c('Olaparib','Olaparib;Trabectedin','Trabectedin'),
                ShpRibo=c('SHP099','Ribociclib;SHP099','Ribociclib'),
                ShpTram=c('SHP099','Trametinib','SHP099;Trametinib'))

eval.drugs.pdx<-c('mirdametinib','mirdametinib+trabectedin','olaparib','trabectedin','ribociclib','trametinib','trametinib+ribociclib')

eval.samps<-c('MN2','WU-225','JHU 2-079','JHU 2-031','MN1','WU-368')

```

### Microtissue Metrics

The first thing we need to do is establish good metrics for evaluating drug sensitivity. We experiment with a few here.

We are focusing on just 3 drugs and 2 combinations at this stage, across 4 PDX/MT/cell line combinations.

### Microtissue Dose Response

```{r plot MT dose response, warning=FALSE, message=FALSE}
library(cowplot)


lapply(names(drug.list), function(drugGroup) {
  mt.subs <- subset(mtDrugData, CellLine %in% eval.samps) %>%
    subset(DrugCol %in% drug.list[[drugGroup]])
  
  samp.plots <- lapply(eval.samps, function(samp)
    plotMTTreatmentByDrug(mt.subs, samp))
  
  ggsave(
    paste0('SampleMT', drugGroup, 'plots.png'),
    cowplot::plot_grid(plotlist = samp.plots, ncol = 2),
    height = 12,
    width = 12
  )


#  drug.plots<-lapply(intersect(drug.list[[drugGroup]],mtDrugData$DrugCol),
  #                   function(drug) plotMTTreatmentBySample(mt.subs,drug))

 # ggsave(paste0('DrugMT',drugGroup,'plots.png'),
  #       cowplot::plot_grid(plotlist = drug.plots,ncol=2),height=12,width=12)
})



```

### PDX Dose Response

```{r plot PDX dose response, warning=FALSE, message=FALSE}



plots <- drugData %>%
  subset(Sample %in% eval.samps) %>%
  subset(drug %in% eval.drugs.pdx) %>%
  group_by(Sample, batch, .drop = F) %>%
  group_map( ~ plotPDXTreatmentBySample(.x), .keep = TRUE)

ggsave('SamplePDXplots.png',
       cowplot::plot_grid(plotlist = plots, ncol = 2))

```

### Incucyte Dose Response

### Cell Line Dose Response
